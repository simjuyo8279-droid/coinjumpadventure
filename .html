<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì½”ì¸ì í”„ ì–´ë“œë²¤ì²˜ ì™„ì „íŒ</title>
<style>
body { margin:0; background:#87ceeb; font-family:sans-serif; text-align:center;}
#game { position:relative; width:400px; height:200px; margin:20px auto; background:#98fb98; overflow:hidden; border:2px solid #333;}
#player { width:20px; height:20px; position:absolute; bottom:0; left:0; background:red;}
#lumy { width:15px; height:15px; position:absolute; bottom:0; left:0; background:pink;}
.coin { width:10px; height:10px; position:absolute; bottom:0; background:gold;}
.obstacle { width:20px; height:20px; position:absolute; bottom:0; background:brown;}
#boss { width:40px; height:40px; position:absolute; bottom:0; left:350px; background:purple; display:none;}
#info { margin-top:10px; font-size:16px;}
#controls { margin-top:10px;}
.control-btn { width:50px; height:50px; font-size:20px; margin:3px;}
.attack { width:10px; height:10px; position:absolute; display:none; background:orange;}
</style>
</head>
<body>

<h2>ì½”ì¸ì í”„ ì–´ë“œë²¤ì²˜ ì™„ì „íŒ</h2>
<div id="game">
  <div id="player"></div>
  <div id="lumy"></div>
  <div id="boss"></div>
</div>
<div id="info">ì½”ì¸: 0</div>
<div id="controls">
  <button class="control-btn" id="leftBtn">â—€</button>
  <button class="control-btn" id="jumpBtn">JUMP</button>
  <button class="control-btn" id="attackBtn">ATTACK</button>
  <button class="control-btn" id="rightBtn">â–¶</button>
</div>

<script>
const game=document.getElementById('game');
const player=document.getElementById('player');
const lumy=document.getElementById('lumy');
const boss=document.getElementById('boss');
const info=document.getElementById('info');

let playerPos=0, playerBottom=0, coins=0;
let moveSpeed=5, movingLeft=false, movingRight=false;
let leftInterval,rightInterval;

// ì €ì¥ëœ ì½”ì¸ ë¶ˆëŸ¬ì˜¤ê¸°
if(localStorage.getItem('coinjump_coins')){
    coins=parseInt(localStorage.getItem('coinjump_coins'));
    info.innerText='ì½”ì¸: '+coins;
}

// ì¥ì• ë¬¼ & ì½”ì¸
const obstacles=[], coinsArr=[];
for(let i=1;i<=8;i++){
    if(Math.random()<0.4){
        let ob=document.createElement('div'); ob.className='obstacle';
        ob.style.left=(i*40)+'px'; game.appendChild(ob);
        obstacles.push({el:ob,pos:i*40});
    }
    if(Math.random()<0.6){
        let c=document.createElement('div'); c.className='coin';
        c.style.left=(i*40+15)+'px'; game.appendChild(c);
        coinsArr.push({el:c,pos:i*40+15,collected:false});
    }
}

// í‚¤ë³´ë“œ
document.addEventListener('keydown',e=>{
    if(e.key==='ArrowRight') movingRight=true;
    if(e.key==='ArrowLeft') movingLeft=true;
    if(e.key==='ArrowUp') jump();
    if(e.key===' ') attack();
});
document.addEventListener('keyup',e=>{
    if(e.key==='ArrowRight') movingRight=false;
    if(e.key==='ArrowLeft') movingLeft=false;
});

// ëª¨ë°”ì¼ í„°ì¹˜
const leftBtn=document.getElementById('leftBtn');
const rightBtn=document.getElementById('rightBtn');
const jumpBtn=document.getElementById('jumpBtn');
const attackBtn=document.getElementById('attackBtn');

leftBtn.addEventListener('touchstart',()=>{ leftInterval=setInterval(()=>move(-moveSpeed),50); });
leftBtn.addEventListener('touchend',()=>{ clearInterval(leftInterval); movingLeft=false; });
rightBtn.addEventListener('touchstart',()=>{ rightInterval=setInterval(()=>move(moveSpeed),50); });
rightBtn.addEventListener('touchend',()=>{ clearInterval(rightInterval); movingRight=false; });
jumpBtn.addEventListener('touchstart',()=>jump());
attackBtn.addEventListener('touchstart', attack);
attackBtn.addEventListener('mousedown', attack); // PC í´ë¦­ ì§€ì›

// ì´ë™
function move(speed){
    playerPos+=speed;
    if(playerPos<0) playerPos=0;
    if(playerPos>380) playerPos=380;
    player.style.left=playerPos+'px';
    lumy.style.left=(playerPos-20>0?playerPos-20:0)+'px';
    checkCollision();
    checkCoins();
}

// ì í”„
function jump(){
    if(playerBottom>0) return;
    let up=0;
    const jumpInterval=setInterval(()=>{
        if(up<50){ playerBottom+=5; up+=5; player.style.bottom=playerBottom+'px'; lumy.style.bottom=(playerBottom-5>0?playerBottom-5:0)+'px'; }
        else { clearInterval(jumpInterval);
            const downInterval=setInterval(()=>{
                if(playerBottom>0){ playerBottom-=5; player.style.bottom=playerBottom+'px'; lumy.style.bottom=(playerBottom-5>0?playerBottom-5:0)+'px'; }
                else clearInterval(downInterval);
            },20);
        }
    },20);
}

// ê³µê²©
function attack(){
    const atk=document.createElement('div'); atk.className='attack';
    atk.style.left=(playerPos+10)+'px'; atk.style.bottom=playerBottom+'px';
    game.appendChild(atk); atk.style.display='block';
    const atkInterval=setInterval(()=>{
        let atkPos=parseInt(atk.style.left);
        if(atkPos>400){ atk.remove(); clearInterval(atkInterval); return; }
        atk.style.left=(atkPos+10)+'px';
        if(boss.style.display==='block' && Math.abs(atkPos-parseInt(boss.style.left))<30){
            alert('ë³´ìŠ¤ ë§ì¶¤! ğŸ‰'); boss.style.display='none';
            atk.remove(); clearInterval(atkInterval);
        }
    },30);
}

// ì¶©ëŒ/ì½”ì¸ ì²´í¬
function checkCollision(){
    for(let ob of obstacles){
        if(Math.abs(playerPos-ob.pos)<20 && playerBottom<20){
            alert('ì¥ì• ë¬¼ ì¶©ëŒ! ê²Œì„ ì¢…ë£Œ ğŸ˜µ\nìµœì¢… ì½”ì¸: '+coins);
            resetGame();
        }
    }
}
function checkCoins(){
    for(let c of coinsArr){
        if(!c.collected && Math.abs(playerPos-c.pos)<15 && playerBottom<30){
            coins++; info.innerText='ì½”ì¸: '+coins;
            localStorage.setItem('coinjump_coins',coins);
            c.el.style.display='none'; c.collected=true;
        }
    }
}

// ë£¨ë¯¸ ìë™ ì½”ì¸ ìˆ˜ì§‘
setInterval(()=>{
    for(let c of coinsArr){
        if(!c.collected && Math.abs(playerPos-c.pos)<50 && playerBottom<30){
            coins++; info.innerText='ì½”ì¸: '+coins;
            localStorage.setItem('coinjump_coins',coins);
            c.el.style.display='none'; c.collected=true;
        }
    }
},200);

// ì§€ì† ì´ë™ + ì†ë„ ì¦ê°€
setInterval(()=>{
    if(movingLeft) move(-moveSpeed);
    if(movingRight) move(moveSpeed);
    if(boss.style.display==='none' && moveSpeed<15) moveSpeed+=0.005;
},50);

// ë³´ìŠ¤ ë“±ì¥
setTimeout(()=>{ boss.style.display='block'; },10000);

// ì´ˆê¸°í™”
function resetGame(){
    playerPos=0; playerBottom=0; coins=0; moveSpeed=5;
    player.style.left='0px'; player.style.bottom='0px'; lumy.style.left='0px'; lumy.style.bottom='0px';
    info.innerText='ì½”ì¸: 0'; localStorage.setItem('coinjump_coins',0);
    movingLeft=false; movingRight=false;
    clearInterval(leftInterval); clearInterval(rightInterval);
    for(let c of coinsArr){ c.collected=false; c.el.style.display='block'; }
    boss.style.display='block';
}
</script>
</body>
    </html>
